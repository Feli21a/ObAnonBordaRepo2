<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Special+Elite&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/css/styleRuleta.css">

    <title>Ruleta de Preguntas con Respuestas</title>
</head>
<body>
    <!-- Información del jugador -->
    <div id="player-info">
        <h2>Jugador: <span id="playerName">Juan</span></h2>
        <p>Preguntas Correctas: <span id="correctAnswers">0</span></p>
    </div>


    <!-- Contenedor principal -->
    <div class="container">
        <div id="chart">
            <div id="marker"></div>
            <button class="spin-button" id="spinButton" onclick="spin()">Girar</button>
        </div>
    </div>

    <!-- Modal de Pregunta y Respuestas -->
    <div id="questionModal" class="modal">
        <div class="modal-content">
            <h2 id="modal-question-text">Pregunta</h2>
            <div id="modal-options">
                <button class="answer-button" onclick="selectAnswer(this)">Opción 1</button>
                <button class="answer-button" onclick="selectAnswer(this)">Opción 2</button>
                <button class="answer-button" onclick="selectAnswer(this)">Opción 3</button>
                <button class="answer-button" onclick="selectAnswer(this)">Opción 4</button>
            </div>
            <button class="close-modal-button" onclick="closeModal()">Cerrar</button>
        </div>
    </div>

    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script>
        var w = 500, h = 500, r = Math.min(w, h) / 2, rotation = 0, oldrotation = 0, picked = 100000, oldpick = [],
            color = d3.scale.category20();

        var data = [
            { "label": "Geografía", "question": "¿Cuál es el país más grande del mundo?", "answers": ["Rusia", "Canadá", "China", "Estados Unidos"] },
            { "label": "Matemáticas", "question": "¿Cuánto es 8 * 7?", "answers": ["56", "54", "58", "62"] },
            { "label": "Historia", "question": "¿Quién fue el primer presidente de los Estados Unidos?", "answers": ["George Washington", "Thomas Jefferson", "John Adams", "Benjamin Franklin"] },
            { "label": "Ciencia", "question": "¿Qué planeta es conocido como el planeta rojo?", "answers": ["Marte", "Venus", "Júpiter", "Saturno"] },
            { "label": "Literatura", "question": "¿Quién escribió 'Don Quijote de la Mancha'?", "answers": ["Miguel de Cervantes", "Federico García Lorca", "Gabriel García Márquez", "Jorge Luis Borges"] },
            { "label": "Deportes", "question": "¿Quién escribió 'Don Quijote de la Mancha'?", "answers": ["Miguel de Cervantes", "Federico García Lorca", "Gabriel García Márquez", "Jorge Luis Borges"] }
        ];

        var svg = d3.select('#chart').append("svg").data([data]).attr("width", w).attr("height", h);
        var container = svg.append("g").attr("class", "chartholder").attr("transform", "translate(" + (w / 2) + "," + (h / 2) + ")");
        var vis = container.append("g");

        var pie = d3.layout.pie().sort(null).value(function () { return 1; });
        var arc = d3.svg.arc().outerRadius(r);

        var arcs = vis.selectAll("g.slice").data(pie).enter().append("g").attr("class", "slice");
        arcs.append("path").attr("fill", function (d, i) { return color(i); }).attr("d", arc);

        arcs.append("text").attr("transform", function (d) {
            d.innerRadius = 0; d.outerRadius = r;
            d.angle = (d.startAngle + d.endAngle) / 2;
            return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")translate(" + (d.outerRadius - 10) + ")";
        }).attr("text-anchor", "end").text(function (d, i) { return data[i].label; });

        function spin() {
            if (oldpick.length === data.length) return;

            var ps = 360 / data.length, rng = Math.floor((Math.random() * 1440) + 360);
            rotation = (Math.round(rng / ps) * ps);
            picked = Math.round(data.length - (rotation % 360) / ps);
            picked = picked >= data.length ? (picked % data.length) : picked;

            if (oldpick.indexOf(picked) !== -1) {
                spin();
                return;
            } else {
                oldpick.push(picked);
            }

            rotation += 90 - Math.round(ps / 2);
            vis.transition().duration(3000).ease("cubic-out").attrTween("transform", rotTween).each("end", function () {
                const question = data[picked].question;
                const answers = data[picked].answers;
                showQuestionModal(question, answers); // Muestra la pregunta y las respuestas en el modal
                oldrotation = rotation;
            });
        }

        function rotTween(to) {
            var i = d3.interpolate(oldrotation % 360, rotation);
            return function (t) {
                return "rotate(" + i(t) + ")";
            };
        }

        // Modal para mostrar la pregunta y las respuestas
        const questionModal = document.getElementById("questionModal");
        const modalQuestionText = document.getElementById("modal-question-text");
        const modalOptions = document.querySelectorAll(".answer-button");

        // Función para mostrar el modal con la pregunta y respuestas
        function showQuestionModal(question, answers) {
            // Establece la pregunta en el modal
            modalQuestionText.textContent = question;

            // Mezcla las respuestas aleatoriamente
            const shuffledAnswers = answers.sort(() => Math.random() - 0.5);

            // Asigna cada respuesta a un botón
            modalOptions.forEach((button, index) => {
                button.textContent = shuffledAnswers[index];
                button.onclick = () => selectAnswer(button.textContent);
            });

            // Muestra el modal
            questionModal.style.display = "flex";
        }

        // Función para cerrar el modal
        function closeModal() {
            questionModal.style.display = "none";
        }

        // Función que se ejecuta cuando el usuario selecciona una respuesta
        function selectAnswer(selectedAnswer) {
            console.log("Respuesta seleccionada:", selectedAnswer);
            closeModal(); // Cierra el modal después de seleccionar la respuesta
            // Aquí podrías añadir lógica para validar la respuesta o realizar cualquier otra acción
        }

        // Cargar el nombre de usuario al cargar la página
        document.addEventListener("DOMContentLoaded", function () {
            fetch("/api/users/perfil")
                .then(response => response.ok ? response.text() : Promise.reject("No se pudo cargar el perfil"))
                .then(username => document.getElementById("playerName").textContent = username)
                .catch(error => console.error("Error al cargar el nombre de usuario:", error));
        });
    </script>
</body>

</html>